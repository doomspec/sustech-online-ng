function post_to_wx(){var e={msgType:"heartbeat",shareTitle:document.title,shareURL:document.URL,scrollTop:document.documentElement.scrollTop,time:(new Date).valueOf()};wx.miniProgram.postMessage({data:e}),wx.miniProgram.getEnv((function(e){window.is_miniprogram=e.miniprogram}))}function handleOutURL(e,t,o){console.log("劫持链接 "+e),wx.miniProgram.navigateTo({url:"/pages/index/redirect?outURL="+encodeURIComponent(e)+"&handleFile="+t+"&ext="+o})}function override_onclick(e){if(window.is_miniprogram){let t=e.currentTarget.getAttribute("href"),o=new URL(t),n=new Set;n.add("mirrors.sustech.edu.cn"),n.add("bus.sustcra.com"),n.add("sustech.online"),n.add("");let a=new Set;a.add("doc"),a.add("docx"),a.add("xls"),a.add("xlsx"),a.add("ppt"),a.add("pptx"),a.add("pdf");let r=o.hostname,d=o.pathname.split(".").pop().toLowerCase(),i=a.has(d);if(n.has(r)&&!i)return console.log("放行白名单页面 "+t),void(window.location.href=t);e.preventDefault(),console.log("小程序环境，拦截外部链接或者可显示文件。"),handleOutURL(t,i,d)}}function reset_all_anchor(){for(var e=document.getElementsByTagName("a"),t=0;t<e.length;t++)e[t].onclick=function(){override_onclick(event)}}setInterval(post_to_wx,1e3),setInterval(reset_all_anchor,1e3);